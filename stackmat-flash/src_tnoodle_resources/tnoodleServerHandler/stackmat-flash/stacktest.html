<!DOCTYPE html>
<html>
<head>
<title>StackApplet Test</title>
<script type="text/javascript" src="/mootools/mootools-core-1.4.2.js"></script>
<script type="text/javascript" src="/mootools/mootools-more-1.4.0.1.js"></script>
<script type="text/javascript" src="StackApplet.js"></script>
<script type="text/javascript">
var enableStackmat;
var configureStackmat;
var appletDiv;

function onUpdate(state) {
	var timerSpan = document.getElementById("timer");
	var leftHand = document.getElementById("leftHand");
	var rightHand = document.getElementById("rightHand");

	if(!state) {
		timerSpan.innerHTML = "";
		leftHand.style.display = "none";
		rightHand.style.display = "none";
	} else {
		if(state.on) {
			timerSpan.innerHTML = state.centis;
		} else {
			timerSpan.innerHTML = "OFF";
		}
		leftHand.style.display = state.leftHand ? "inline" : "none";
		rightHand.style.display = state.rightHand ? "inline" : "none";
	}
}
function showApplet(visible) {
	configureStackmat.checked = visible;

	if(visible) {
		appletDiv.setStyle('width', '');
		appletDiv.setStyle('height', '');
	} else {
		appletDiv.setStyle('width', 0);
		appletDiv.setStyle('height', 0);
	}
}
function onError(error) {
	if(error.message == 'muted') {
		error.message = 'Please grant flash microphone access.';
	}
	alert(error.message);
	showApplet(true);
}

window.addEventListener('load', function() {
	enableStackmat = document.getElementById('enableStackmat');
	configureStackmat = document.getElementById('configureStackmat');
	configureSpan = document.getElementById('configureSpan');
	configureSpan.hide();

	appletDiv = document.getElementById('appletDiv');
	appletDiv.setStyle('overflow', 'hidden');

	showApplet(false);
	enableStackmat.addEvent('change', function() {
		if(enableStackmat.checked) {
			configureSpan.show();
			tnoodle.stackmat.enable(onUpdate, onError, appletDiv);
		} else {
			configureSpan.hide();
			tnoodle.stackmat.disable();
		}
	});

	configureStackmat.addEvent('change', function() {
		showApplet(configureStackmat.checked);
	});

	onUpdate();
}, false);
</script>
</head>
<body>

<div>
	<input type="checkbox" id="enableStackmat" />
	<label for="enableStackmat">Enable stackmat</label>

	<span id="configureSpan">
		<input type="checkbox" id="configureStackmat" />
		<label for="configureStackmat">Configure stackmat</label>
	</span>
</div>

<div id="appletDiv"></div>

<div>
	<span id="leftHand">\</span>
	<span id="rightHand">/</span>
	<span id="timer"></span>
</div>

</body>
</html>
